# Some Common Indexes

本节会介绍几种常见的索引以及部分特性。

主键索引，它是聚簇索引，如果建表时没有指定主键，InnoDB会自动生成一个隐藏字段作为聚簇索引，该列随插入自增。

普通索引，为了提升查询效率而建立的索引，是非聚簇索引，需要回表。

唯一索引，在普通索引的基础上，保证字段的唯一性，业务有唯一需求的情况下，通常作为保底来保证唯一性。

在业务能够保证唯一的情况下，建议使用普通索引，它们在查询上的性能几乎一致，而在更新方面普通索引更为优越。

为什么呢？这里先介绍Change Buffer这一概念，当数据页不在内存时，InnoDB会将更新操作缓存在Change Buffer中，等该数据页因为某次查询加载到内存中后，再去执行Change Buffer中的操作，以此减少从磁盘加载数据到内存的次数。

由于唯一索引需要保证唯一性，更新数据时，如果数据页不在内存中，则需要立即加载它，来判断是否唯一，因此无法用到Change Buffer，而普通索引能够使用Change Buffer。

前缀索引，对字段的前几个字符建立索引，因为索引字段就是用来构建B+树的，如果索引字段存的数据太多，InnoDB一次取数据页只有16KB，那么相应地能够存的索引数量就会变少。因此如果某个索引字段需要存储大段的文本的话，建议使用前缀索引。

联合索引，就是多个字段共同作为索引，虽说是共同，其实底层建立B+树时，也是有先后顺序的，以建立联合索引时字段的顺序为依据，因此在匹配时，也是先根据第一个字段来匹配的，如果你的SQL语句where后面先跟的不是第一个字段而是第二个字段，但是索引B+树上第二个字段是无序的，于是走了全表扫描。只有先根据第一个字段确定了一定的范围，在这个范围内第二个字段是有序的，才能有效地使用索引。我们使用最左匹配原则来判断联合索引是否生效，上面我们讲述了违反最左匹配原则的底层原因，关键还是要理解为什么B+树作为索引。

覆盖索引，其实它并不是索引，而是一个概念，如果一个索引包含所有需要查询的字段的值，则称之为覆盖索引，由于是根据索引字段的值来建立索引的，B+树key域就存储了需要查询的字段的值，因此不需要回表。

以上我们介绍了常见的几种索引类型，主键索引，普通索引，唯一索引，前缀索引，联合索引以及覆盖索引这一概念，在理解了B+树作为底层的索引结构后，以上都是水到渠成的事了。
