# MySQL Infrastructure

要讲清楚一条SQL语句是如何执行的，首先要了解MySQL的基础架构，包括Server层和存储引擎。存储引擎最常见的是InnoDB，还有就是MyISAM。Server层包括连接器、分析器、优化器和执行器（MySQL在8.0之后移除了查询缓存功能，其在很多情况下效率并不高，所以这里就不介绍了）。

连接器，就是用来与客户端建立连接的，由于连接过程比较复杂，尽量使用长连接。MySQL在执行过程中临时使用的内存是管理在连接对象里的，这些资源会在连接断开时才释放，如果长连接累积下来，可能导致内存占用太大，被系统强行杀掉（OOM），从现象看就是MySQL异常重启了。

分析器，主要做词法分析和语法分析。

优化器，确定最优的执行策略，比如有多个索引供选择时，它会采样统计索引的“区分度”，然后估算出要扫描的行数。

执行器，调用存储引擎提供的接口，存储引擎讲查询到的数据返回给执行器，执行器再做某些处理后返回给客户端。

存储引擎，具体查询、更新这些操作都是在存储引擎中执行的，执行器通过调用存储引擎对应的接口完成相应操作。
